name: 🔄 Refresh Fyers Token

on: schedule: - cron: '15 3 * * *'  # Runs daily at 8:45 AM IST workflow_dispatch:

jobs: refresh_token: runs-on: ubuntu-latest

env:
  TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
  TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
  FYERS_APP_ID: ${{ secrets.FYERS_APP_ID }}
  FYERS_APP_SECRET: ${{ secrets.FYERS_APP_SECRET }}
  FYERS_REDIRECT_URI: ${{ secrets.FYERS_REDIRECT_URI }}
  FYERS_USERNAME: ${{ secrets.FYERS_USERNAME }}
  FYERS_PASSWORD: ${{ secrets.FYERS_PASSWORD }}
  FYERS_PIN: ${{ secrets.FYERS_PIN }}

steps:
- name: ⬇️ Checkout repo
  uses: actions/checkout@v3

- name: 🤮 Install Chrome
  uses: browser-actions/setup-chrome@v1

- name: 🤮 Install ChromeDriver
  uses: nanasess/setup-chromedriver@v2
  with:
    chrome-version: 'stable'

- name: 🐍 Set up Python
  uses: actions/setup-python@v4
  with:
    python-version: '3.10'

- name: 📦 Install dependencies
  run: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt

- name: 🔐 Print debug vars (safe)
  run: |
    echo "TELEGRAM_TOKEN set: ${{ secrets.TELEGRAM_TOKEN != '' }}"
    echo "FYERS_APP_ID set: ${{ secrets.FYERS_APP_ID != '' }}"

- name: 🔐 Run token bot script
  run: python token_bot.py

- name: 📂 Upload token file (optional)
  uses: actions/upload-artifact@v4
  with:
    name: access_token
    path: access_token.json

